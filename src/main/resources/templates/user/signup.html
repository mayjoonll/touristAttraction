<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>회원가입 | K-Explore</title>
    <th:block th:replace="fragments/header :: styles"></th:block>
    <style>
        :root { --gap: 24px; }
        * { box-sizing: border-box; }
        body { margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif; color:#111; }
        a { color: inherit; text-decoration: none; }
        .wrap { min-height: 100vh; display:flex; flex-direction:column; }
        .header { height:64px; display:flex; align-items:center; justify-content:space-between; padding:0 24px; border-bottom:1px solid #eee; }
        .brand { font-weight:800; font-size:28px; letter-spacing:.5px; }
        .actions { display:flex; align-items:center; gap:12px; }
        .search { width: 380px; height:38px; border:1px solid #e5e5e5; border-radius:8px; padding:0 12px; background:#fafafa; }
        .btn { height:36px; padding:0 14px; border:1px solid #e5e5e5; border-radius:10px; background:#fff; cursor:pointer; }
        .container { flex:1; display:grid; place-items:center; padding:48px 16px; }
        .card { width: 640px; max-width: 94vw; padding:48px 56px; border-radius:16px; border:1px solid #f0f0f0; background:#fff; }
        .title { text-align:center; font-weight:800; font-size:28px; margin-bottom:32px; }
        .field { margin-bottom:18px; }
        label { display:block; font-size:13px; color:#777; margin-bottom:8px; }
        input[type=text], input[type=password], input[type=email] {
          width:100%; height:44px; border:1px solid #eee; border-radius:10px; background:#f7f7f7;
          padding:0 14px; outline:none;
        }
        input:focus { border-color:#ddd; background:#fff; transition:.15s; }
        .row { display:flex; gap:10px; align-items:center; }
        .row > input { flex:1; }
        .sm-btn { height:44px; padding:0 12px; border:1px solid #e5e5e5; border-radius:10px; background:#fff; cursor:pointer; white-space:nowrap; }
        .hint { font-size:12px; color:#888; margin-top:6px; }
        .error { color:#e74c3c; font-size:12px; margin-top:6px; }
        .ok { color:#2c974b; font-size:12px; margin-top:6px; }
        .submit { width:100%; height:48px; margin-top:10px; border:none; border-radius:12px; background:#f2f2f2; color:#9a9a9a; font-weight:700; cursor:pointer; }
    </style>
</head>
<body>
<div th:replace="fragments/header :: header"></div>
<div class="wrap">
    <header class="header">
        <div class="brand">Tour</div>
        <div class="actions">
            <input class="search" type="text" placeholder="여행지를 검색해보세요.">
            <a class="btn" th:href="@{/login}">로그인/회원가입</a>
            <div class="menu">≡</div>
        </div>
    </header>

    <main class="container">
        <section class="card">
            <h1 class="title">회원가입</h1>

            <form th:action="@{/user/signup}" method="post" th:object="${user}" onsubmit="return validateSignup();">
                <p th:if="${error}" th:text="${error}" class="error"></p>

                <div class="field">
                    <label for="username">아이디</label>
                    <div class="row">
                        <input id="username" type="text" th:field="*{username}" placeholder="아이디를 입력하세요" required>
                        <button class="sm-btn" type="button" onclick="checkUsername()">중복확인</button>
                    </div>
                    <span id="usernameResult" class="hint"></span>
                    <div th:if="${#fields.hasErrors('username')}" th:errors="*{username}" class="error"></div>
                </div>

                <div class="field">
                    <label for="password">비밀번호</label>
                    <input id="password" type="password" th:field="*{password}" placeholder="비밀번호를 입력하세요" required>
                    <div th:if="${#fields.hasErrors('password')}" th:errors="*{password}" class="error"></div>
                </div>
                <div class="field">
                    <label for="passwordConfirm">비밀번호 확인</label>
                    <input id="passwordConfirm" type="password" placeholder="비밀번호를 다시 입력하세요" required>
                    <div id="pwMatchMsg" class="hint"></div>
                </div>

                <div class="field">
                    <label for="name">이름</label>
                    <input id="name" type="text" th:field="*{name}" placeholder="이름을 입력하세요" required>
                    <div th:if="${#fields.hasErrors('name')}" th:errors="*{name}" class="error"></div>
                </div>

                <div class="field">
                    <label for="nickname">닉네임</label>
                    <input id="nickname" type="text" th:field="*{nickname}" placeholder="닉네임을 입력하세요" required>
                    <div th:if="${#fields.hasErrors('nickname')}" th:errors="*{nickname}" class="error"></div>
                </div>

                <div class="field">
                    <label for="email">이메일</label>
                    <input id="email" type="email" th:field="*{email}" placeholder="이메일을 입력하세요" required>
                    <div th:if="${#fields.hasErrors('email')}" th:errors="*{email}" class="error"></div>
                </div>

                <button class="submit" type="submit">회원가입</button>
            </form>
        </section>
    </main>
</div>

<script>
    function setResult(id, msg, ok) {
      const el = document.getElementById(id);
      el.textContent = msg;
      el.className = ok ? 'ok' : 'error';
    }

    function checkUsername() {
      const v = document.getElementById('username').value.trim();
      if (!v) return setResult('usernameResult', '아이디를 입력하세요.', false);
      fetch(`/user/checkUsername?username=${encodeURIComponent(v)}`)
        .then(r => r.json())
        .then(exists => setResult('usernameResult',
                exists ? '이미 사용 중인 아이디입니다.' : '사용 가능한 아이디입니다.',
                !exists))
        .catch(() => setResult('usernameResult', '확인 중 오류가 발생했습니다.', false));
    }

    function validateSignup() {
      const pw = document.getElementById('password').value;
      const pw2 = document.getElementById('passwordConfirm').value;
      const msg = document.getElementById('pwMatchMsg');
      if (pw !== pw2) {
        msg.textContent = '비밀번호가 일치하지 않습니다.';
        msg.className = 'error';
        return false;
      }
      msg.textContent = '';
      return true;
    }
</script>
</body>
</html>