<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>마이페이지 | K-Explore</title>

    <!-- 헤더 스타일 -->
    <th:block th:replace="fragments/header :: styles"></th:block>

    <style>
        :root{--gap:24px}
        *{box-sizing:border-box}
        body{margin:0;font-family:system-ui,-apple-system,"Noto Sans KR",Segoe UI,Roboto,sans-serif;color:#111}
        a{text-decoration:none;color:inherit}
        .container{max-width:1120px;margin:0 auto;padding:32px 16px}
        .page-title{font-size:32px;font-weight:800;margin:16px 0 24px}
        .grid{display:grid;grid-template-columns:260px 1fr;gap:32px}
        .sidebar{border:1px solid #eee;border-radius:14px;background:#fafafa;padding:18px 16px}
        .section-title{font-size:14px;color:#777;margin:10px 0 8px}
        .menu{list-style:none;padding:0;margin:0}
        .menu li{margin:2px 0}
        .menu a{display:block;padding:10px 12px;border-radius:10px;color:#333}
        .menu a.active,.menu a:hover{background:#111;color:#fff}
        .card{border:1px solid #eee;border-radius:14px;background:#fff}
        .card + .card{margin-top:16px}
        .card-body{display:flex;align-items:center;justify-content:space-between;padding:18px 20px}
        .label{font-size:13px;color:#777;margin-bottom:4px}
        .value{font-size:16px;font-weight:700}
        .muted{font-size:12px;color:#999;margin-left:8px}
        .btn{height:34px;padding:0 14px;border:1px solid #e5e5e5;border-radius:10px;background:#fff;cursor:pointer}
        .btn.dark{background:#111;color:#fff;border-color:#111}
        .btn.small{height:30px}
        .btn.danger{background:#fef2f2;border-color:#ffd8d8;color:#d11}
        input[type=text], input[type=email], input[type=password] {
            width: 100%; padding:8px 10px; border:1px solid #ccc; border-radius:8px; margin-top:4px;
        }
        form { margin-top:8px; }
        @media (max-width: 960px){.grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
<!-- 공통 헤더 -->
<div th:replace="fragments/header :: header"></div>

<div class="container">
    <h1 class="page-title" th:text="${#authentication?.name} + ' 님'">사용자 님</h1>

    <div class="grid">
        <aside class="sidebar">
            <div class="section">
                <div class="section-title">예약 정보</div>
                <ul class="menu">
                    <li><a th:href="@{/user/favorites}">즐겨찾기</a></li>
                </ul>
            </div>
            <div class="section" style="margin-top:12px">
                <div class="section-title">내 정보</div>
                <ul class="menu">
                    <li><a th:href="@{/user/myReviews}">댓글</a></li>
                </ul>
            </div>
        </aside>

        <section>
            <!-- 이메일 수정 -->
            <div class="card">
                <div class="card-body">
                    <div>
                        <div class="label">연동된 이메일</div>
                        <div class="value" th:text="${user?.email} ?: 'example@abc.com'">example@abc.com</div>
                        <form th:action="@{/user/email/edit}" method="post">
                            <input type="email" name="email" th:value="${user?.email}" placeholder="이메일 입력" required>
                            <button type="submit" class="btn small">수정</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- 비밀번호 수정 -->
            <div class="card">
                <div class="card-body">
                    <div>
                        <div class="label">비밀번호</div>
                        <div class="value">비밀번호를 설정하세요</div>
                        <form th:action="@{/user/password/edit}" method="post">
                            <input type="password" name="currentPassword" placeholder="현재 비밀번호" required>
                            <input type="password" name="newPassword" placeholder="새 비밀번호" required>
                            <input type="password" name="confirmPassword" placeholder="새 비밀번호 확인" required>
                            <button type="submit" class="btn dark">변경</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- 이름 수정 -->
            <div class="card">
                <div class="card-body">
                    <div>
                        <div class="label">이름</div>
                        <div class="value" th:text="${user?.name} ?: '홍길동'">홍길동</div>
                        <form th:action="@{/user/name/edit}" method="post">
                            <input type="text" name="name" th:value="${user?.name}" placeholder="이름 입력" required>
                            <button type="submit" class="btn small">수정</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- 닉네임 수정 -->
            <div class="card">
                <div class="card-body">
                    <div>
                        <div class="label">닉네임</div>
                        <div class="value" th:text="${user?.nickname} ?: 'Hong'">Hong</div>
                        <form th:action="@{/user/nickname/edit}" method="post">
                            <input type="text" name="nickname" th:value="${user?.nickname}" placeholder="닉네임 입력" required>
                            <button type="submit" class="btn small">수정</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- 로그아웃 / 회원탈퇴 -->
            <div style="margin-top:18px;display:flex;gap:10px">
                <form th:action="@{/logout}" method="post">
                    <button class="btn" type="submit">로그아웃</button>
                </form>
                <form th:action="@{/user/withdraw}" method="post" onsubmit="return confirm('정말 탈퇴하시겠습니까?');">
                    <button class="btn danger" type="submit">회원탈퇴</button>
                </form>
            </div>
        </section>
    </div>
</div>
</body>
</html>
